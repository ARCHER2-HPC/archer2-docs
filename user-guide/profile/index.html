
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.4">
    
    
      
        <title>Profiling - ARCHER2 User Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/archer2.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#profiling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ARCHER2 User Documentation" class="md-header__button md-logo" aria-label="ARCHER2 User Documentation" data-md-component="logo">
      
  <img src="../../images/archer2_white_transparent.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ARCHER2 User Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Profiling
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ARCHER2-HPC/archer2-docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ARCHER2-HPC/archer2-docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ARCHER2 User Documentation" class="md-nav__button md-logo" aria-label="ARCHER2 User Documentation" data-md-component="logo">
      
  <img src="../../images/archer2_white_transparent.png" alt="logo">

    </a>
    ARCHER2 User Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ARCHER2-HPC/archer2-docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ARCHER2-HPC/archer2-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Documentation overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Quickstart
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Quickstart" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Quickstart
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start/quickstart-users/" class="md-nav__link">
        Quickstart for users
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start/quickstart-developers/" class="md-nav__link">
        Quickstart for developers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../known-issues/" class="md-nav__link">
        ARCHER2 Known Issues
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        ARCHER2 Frequently Asked Questions
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          User and Best Practice Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User and Best Practice Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          User and Best Practice Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hardware/" class="md-nav__link">
        Hardware
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../connecting/" class="md-nav__link">
        Connecting to ARCHER2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        Data management and transfer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sw-environment/" class="md-nav__link">
        Software environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scheduler/" class="md-nav__link">
        Running jobs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        I/O and file systems
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev-environment/" class="md-nav__link">
        Application development environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../containers/" class="md-nav__link">
        Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python/" class="md-nav__link">
        Using Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../analysis/" class="md-nav__link">
        Data analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debug/" class="md-nav__link">
        Debugging
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Profiling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Profiling
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#craypat-lite" class="md-nav__link">
    CrayPat-lite
  </a>
  
    <nav class="md-nav" aria-label="CrayPat-lite">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-use-craypat-lite" class="md-nav__link">
    How to use CrayPat-lite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#further-help" class="md-nav__link">
    Further help
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#craypat" class="md-nav__link">
    CrayPat
  </a>
  
    <nav class="md-nav" aria-label="CrayPat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling-analysis" class="md-nav__link">
    Sampling analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracing-analysis" class="md-nav__link">
    Tracing analysis
  </a>
  
    <nav class="md-nav" aria-label="Tracing analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-program-analysis-apa" class="md-nav__link">
    Automatic Program Analysis (APA)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-program-analysis" class="md-nav__link">
    Manual Program Analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamically-linked-binaries" class="md-nav__link">
    Dynamically-linked binaries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#further-help_1" class="md-nav__link">
    Further help
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cray-apprentice2" class="md-nav__link">
    Cray Apprentice2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware-performance-counters" class="md-nav__link">
    Hardware Performance Counters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-and-profiling-data-in-slurm" class="md-nav__link">
    Performance and profiling data in Slurm
  </a>
  
    <nav class="md-nav" aria-label="Performance and profiling data in Slurm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-sstat-for-running-jobs" class="md-nav__link">
    Example 1: sstat for running jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-sacct-for-finished-jobs" class="md-nav__link">
    Example 2: sacct for finished jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-archer2jobload-for-running-jobs" class="md-nav__link">
    Example 3: archer2jobload for running jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#further-help-with-slurm" class="md-nav__link">
    Further help with Slurm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tuning/" class="md-nav__link">
        Performance tuning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../energy-monitoring/" class="md-nav__link">
        Energy monitoring
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Research Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Research Software" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Research Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/castep/castep/" class="md-nav__link">
        CASTEP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/chemshell/chemshell/" class="md-nav__link">
        Chemshell
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/code-saturne/code-saturne/" class="md-nav__link">
        Code_Saturne
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/cp2k/cp2k/" class="md-nav__link">
        CP2K
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/elk/elk/" class="md-nav__link">
        ELK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/fenics/fenics/" class="md-nav__link">
        FEniCS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/gromacs/gromacs/" class="md-nav__link">
        GROMACS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/lammps/lammps/" class="md-nav__link">
        LAMMPS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/mitgcm/mitgcm/" class="md-nav__link">
        MITgcm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/mo-unified-model/mo-unified-model/" class="md-nav__link">
        Met Office Unified Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/namd/namd/" class="md-nav__link">
        NAMD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/nektarplusplus/nektarplusplus/" class="md-nav__link">
        Nektar++
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/nemo/nemo/" class="md-nav__link">
        NEMO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/nwchem/nwchem/" class="md-nav__link">
        NWChem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/onetep/onetep/" class="md-nav__link">
        ONETEP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/openfoam/openfoam/" class="md-nav__link">
        OpenFOAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/qe/qe/" class="md-nav__link">
        Quantum Espresso
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research-software/vasp/vasp/" class="md-nav__link">
        VASP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Software Libraries
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Software Libraries" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Software Libraries
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/libsci/" class="md-nav__link">
        HPE Cray LibSci: BLAS, LAPACK, ScaLAPACK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/fftw/" class="md-nav__link">
        FFTW
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/hdf5/" class="md-nav__link">
        HDF5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/netcdf/" class="md-nav__link">
        NetCDF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/adios/" class="md-nav__link">
        ADIOS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/arpack/" class="md-nav__link">
        ARPACK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/boost/" class="md-nav__link">
        Boost
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/eigen/" class="md-nav__link">
        Eigen
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/glm/" class="md-nav__link">
        GLM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/hypre/" class="md-nav__link">
        HYPRE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/matio/" class="md-nav__link">
        Matio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/mkl/" class="md-nav__link">
        Intel MKL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/mumps/" class="md-nav__link">
        MUMPS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/petsc/" class="md-nav__link">
        PETSc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/metis/" class="md-nav__link">
        Metis/Parmetis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/scotch/" class="md-nav__link">
        Scotch/PT-Scotch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/slepc/" class="md-nav__link">
        SLEPc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/superlu/" class="md-nav__link">
        SuperLU/SuperLU_DIST
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/trilinos/" class="md-nav__link">
        Trilinos
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Data Analysis and Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Analysis and Tools" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Data Analysis and Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../data-tools/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../data-tools/paraview/" class="md-nav__link">
        ParaView
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../data-tools/cray-r/" class="md-nav__link">
        R
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../data-tools/visidata/" class="md-nav__link">
        VisiData
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Other Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Other Software" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Other Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../other-software/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../other-software/crystal/" class="md-nav__link">
        CRYSTAL
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../essentials/" class="md-nav__link">
        Essential Skills
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../publish/" class="md-nav__link">
        ARCHER2 and Publications
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#craypat-lite" class="md-nav__link">
    CrayPat-lite
  </a>
  
    <nav class="md-nav" aria-label="CrayPat-lite">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-use-craypat-lite" class="md-nav__link">
    How to use CrayPat-lite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#further-help" class="md-nav__link">
    Further help
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#craypat" class="md-nav__link">
    CrayPat
  </a>
  
    <nav class="md-nav" aria-label="CrayPat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling-analysis" class="md-nav__link">
    Sampling analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracing-analysis" class="md-nav__link">
    Tracing analysis
  </a>
  
    <nav class="md-nav" aria-label="Tracing analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-program-analysis-apa" class="md-nav__link">
    Automatic Program Analysis (APA)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-program-analysis" class="md-nav__link">
    Manual Program Analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamically-linked-binaries" class="md-nav__link">
    Dynamically-linked binaries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#further-help_1" class="md-nav__link">
    Further help
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cray-apprentice2" class="md-nav__link">
    Cray Apprentice2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware-performance-counters" class="md-nav__link">
    Hardware Performance Counters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-and-profiling-data-in-slurm" class="md-nav__link">
    Performance and profiling data in Slurm
  </a>
  
    <nav class="md-nav" aria-label="Performance and profiling data in Slurm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-sstat-for-running-jobs" class="md-nav__link">
    Example 1: sstat for running jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-sacct-for-finished-jobs" class="md-nav__link">
    Example 2: sacct for finished jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-archer2jobload-for-running-jobs" class="md-nav__link">
    Example 3: archer2jobload for running jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#further-help-with-slurm" class="md-nav__link">
    Further help with Slurm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/ARCHER2-HPC/archer2-docs/edit/main/docs/user-guide/profile.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<h1 id="profiling">Profiling</h1>
<p>There are a number of different ways to access profiling data on 
ARCHER2. In this section, we discuss the HPE Cray profiling tools,
CrayPAT-lite and CrayPAT. We also show how to get usage data
on currently running jobs from Slurm batch system.</p>
<h2 id="craypat-lite">CrayPat-lite</h2>
<p>CrayPat-lite is a simplified and easy-to-use version of the Cray
Performance Measurement and Analysis Tool (CrayPat). CrayPat-lite
provides basic performance analysis information automatically, with a
minimum of user interaction, and yet offers information useful to users
wishing to explore a program's behaviour further using the full CrayPat
suite.</p>
<h3 id="how-to-use-craypat-lite">How to use CrayPat-lite</h3>
<ol>
<li>
<p>Ensure the <code>perftools-base</code> module is loaded.</p>
<p><code>module list</code></p>
</li>
<li>
<p>Load the <code>perftools-lite</code> module.</p>
<p><code>module load perftools-lite</code></p>
</li>
<li>
<p>Compile your application normally. An informational message from
    CrayPat-lite will appear indicating that the executable has been
    instrumented.</p>
<div class="highlight"><pre><span></span><code>cc -h std=c99  -o myapplication.x myapplication.c
</code></pre></div>
<div class="highlight"><pre><span></span><code>INFO: creating the CrayPat-instrumented executable &#39;myapplication.x&#39; (lite-samples) ...OK  
</code></pre></div>
</li>
<li>
<p>Run the generated executable normally by submitting a job.</p>
<div class="highlight"><pre><span></span><code>#!/bin/bash

#SBATCH --job-name=craypat_test
#SBATCH --nodes=4
#SBATCH --tasks-per-node=128
#SBATCH --cpus-per-task=1
#SBATCH --time=00:20:00

#SBATCH --account=[budget code]
#SBATCH --partition=standard
#SBATCH --qos=standard

# Launch the parallel program
srun --hint=nomultithread --distribution=block:block mpi_test.x
</code></pre></div>
</li>
<li>
<p>Analyse the data.</p>
<p>After the job finishes executing, CrayPat-lite output should be printed
to stdout (i.e. at the end of the job's output file). A new directory will
also be created containing <code>.rpt</code> and <code>.ap2</code> files. The <code>.rpt</code> files are text
files that contain the same information printed in the job's output file and
the <code>.ap2</code> files can be used to obtain more detailed information, which can be
visualized using the <a href="#cray-apprentice2">Cray Apprentice2 tool</a>.</p>
</li>
</ol>
<h3 id="further-help">Further help</h3>
<ul>
<li><a href="https://support.hpe.com/hpesc/public/docDisplay?docId=a00114942en_us&amp;page=index.html">CrayPat-lite User Guide</a></li>
</ul>
<h2 id="craypat">CrayPat</h2>
<p>The Cray Performance Analysis Tool (CrayPAT) is a powerful framework for
analysing a parallel application’s performance on Cray supercomputers.
It can provide very detailed information about the timing and performance
of individual application procedures.</p>
<p>CrayPat can perform two types of performance analysis, <em>sampling</em>
experiments and <em>tracing</em> experiments. A sampling experiment probes the
code at a predefined interval and produces a report based on the data
collected. A tracing experiment explicitly monitors the code
performance within named routines. Typically, the overhead associated
with a tracing experiment is higher than that associated with a sampling
experiment but provides much more detailed information. The key to
getting useful data out of a sampling experiment is to run your
profiling for a representative length of time.</p>
<h3 id="sampling-analysis">Sampling analysis</h3>
<ol>
<li>
<p>Ensure the <code>perftools-base</code> module is loaded.</p>
<p><code>module list</code></p>
</li>
<li>
<p>Load <code>perftools</code> module.</p>
<p><code>module load perftools</code></p>
</li>
<li>
<p>Compile your code in the standard way always using the Cray compiler
    wrappers (ftn, cc and CC). Object files need to be made available to
    CrayPat to correctly build an instrumented executable for profiling
    or tracing, this means that the compile and link stage should be
    separated by using the <code>-c</code> compile flag.</p>
<div class="highlight"><pre><span></span><code>auser@ln01:/work/t01/t01/auser&gt; cc -h std=c99 -c jacobi.c
auser@ln01:/work/t01/t01/auser&gt; cc jacobi.o -o jacobi
</code></pre></div>
</li>
<li>
<p>To instrument the binary, run the <code>pat_build</code> command. This will 
    generate a new binary with <code>+pat</code> appended to the end (e.g. <code>jacobi+pat</code>).</p>
<p><code>auser@ln:/work/t01/t01/auser&gt; pat_build jacobi</code></p>
</li>
<li>
<p>Run the new executable with <code>+pat</code> appended as you would with the
    regular executable. Each run will produce its own 'experiment
    directory' containing the performance data as <code>.xf</code> files
    inside a subdirectory called <code>xf-files</code> (e.g. running the 
    <code>jacobi+pat</code> instrumented executable might produce
    <code>jacobi+pat+12265-1573s/xf-files</code>).</p>
</li>
<li>Generate report data with <code>pat_report</code>.</li>
</ol>
<p>The <code>.xf</code> files contain the raw sampling data from the run and need to
be post-processed to produce useful results. This is done using the
<code>pat_report</code> tool which converts all the raw data into a summarised and
readable form. You should provide the name of the experiment directory as
the argument to <code>pat_report</code>.</p>
<pre><code>auser@ln:/work/t01/t01/auser&gt; pat_report jacobi+pat+12265-1573s

Table 1:  Profile by Function (limited entries shown)

Samp% |  Samp |  Imb. |  Imb. | Group
        |       |  Samp | Samp% |  Function
        |       |       |       |   PE=HIDE
100.0% | 849.5 |    -- |    -- | Total
|--------------------------------------------------
|  56.7% | 481.4 |    -- |    -- | MPI
||-------------------------------------------------
||  48.7% | 414.1 |  50.9 | 11.0% | MPI_Allreduce
||   4.4% |  37.5 | 118.5 | 76.6% | MPI_Waitall
||   3.0% |  25.2 |  44.8 | 64.5% | MPI_Isend
||=================================================
|  29.9% | 253.9 |  55.1 | 18.0% | USER
||-------------------------------------------------
||  29.9% | 253.9 |  55.1 | 18.0% | main
||=================================================
|  13.4% | 114.1 |    -- |    -- | ETC
||-------------------------------------------------
||  13.4% | 113.9 |  26.1 | 18.8% | __cray_memcpy_SNB
|==================================================
</code></pre>
<p>This report will generate more files with the extension <code>.ap2</code> in the
experiment directory. These hold the same data as the <code>.xf</code> files but
in the post-processed form. Another file produced has an <code>.apa</code> extension
and is a text file with a suggested configuration for generating a
traced experiment. </p>
<p>The <code>.ap2</code> files generated are used to view performance
data graphically with the <a href="#cray-apprentice2">Cray Apprentice2 tool</a>.</p>
<p>The <code>pat_report</code> command is able to produce many different profile
reports from the profiling data. You can select a predefined report with
the <code>-O</code> flag to <code>pat_report</code>. A selection of the most generally useful
predefined report types are:= listed below.</p>
<ul>
<li><strong>ca+src</strong> - Show the callers (bottom-up view) leading to the
    routines that have a high use in the report and include source code
    line numbers for the calls and time-consuming statements.</li>
<li><strong>load_balance</strong> - Show load-balance statistics for the high-use
    routines in the program. Parallel processes with minimum, maximum
    and median times for routines will be displayed. Only available with
    tracing experiments.</li>
<li><strong>mpi_callers</strong> - Show MPI message statistics. Only available with
    tracing experiments.</li>
</ul>
<p>Example output:</p>
<pre><code>auser@ln01:/work/t01/t01/auser&gt; pat_report -O ca+src,load_balance  jacobi+pat+12265-1573s

Table 1:  Profile by Function and Callers, with Line Numbers (limited entries shown)

Samp% |  Samp |  Imb. |  Imb. | Group
        |       |  Samp | Samp% |  Function
        |       |       |       |   PE=HIDE
100.0% | 849.5 |    -- |    -- | Total
|--------------------------------------------------
|--------------------------------------
|  56.7% | 481.4 | MPI
||-------------------------------------
||  48.7% | 414.1 | MPI_Allreduce
3|        |       |  main:jacobi.c:line.80
||   4.4% |  37.5 | MPI_Waitall
3|        |       |  main:jacobi.c:line.73
||   3.0% |  25.2 | MPI_Isend
|||------------------------------------
3||   1.6% |  13.2 | main:jacobi.c:line.65
3||   1.4% |  12.0 | main:jacobi.c:line.69
||=====================================
|  29.9% | 253.9 | USER
||-------------------------------------
||  29.9% | 253.9 | main
|||------------------------------------
3||  18.7% | 159.0 | main:jacobi.c:line.76
3||   9.1% |  76.9 | main:jacobi.c:line.84
|||====================================
||=====================================
|  13.4% | 114.1 | ETC
||-------------------------------------
||  13.4% | 113.9 | __cray_memcpy_SNB
3|        |       |  __cray_memcpy_SNB
|======================================
</code></pre>
<h3 id="tracing-analysis">Tracing analysis</h3>
<h4 id="automatic-program-analysis-apa">Automatic Program Analysis (APA)</h4>
<p>We can produce a focused tracing experiment based on the results from
the <em>sampling</em> experiment using <code>pat_build</code> with the <code>.apa</code> file
produced during the sampling.</p>
<pre><code>auser@ln01:/work/t01/t01/auser&gt; pat_build -O jacobi+pat+12265-1573s/build-options.apa
</code></pre>
<p>This will produce a third binary with extension <code>+apa</code>. This binary
should once again be run on the compute nodes and the name of the
executable changed to <code>jacobi+apa</code>. As with the sampling analysis, a
report can be produced using <code>pat_report</code>. For example:</p>
<pre><code>auser@ln01:/work/t01/t01/auser&gt; pat_report jacobi+apa+13955-1573t

Table 1:  Profile by Function Group and Function (limited entries shown)

Time% |      Time |     Imb. |  Imb. |       Calls | Group
        |           |     Time | Time% |             |  Function
        |           |          |       |             |   PE=HIDE

100.0% | 12.987762 |       -- |    -- | 1,387,544.9 | Total
|-------------------------------------------------------------------------
|  44.9% |  5.831320 |       -- |    -- |         2.0 | USER
||------------------------------------------------------------------------
||  44.9% |  5.831229 | 0.398671 |  6.4% |         1.0 | main
||========================================================================
|  29.2% |  3.789904 |       -- |    -- |   199,111.0 | MPI_SYNC
||------------------------------------------------------------------------
||  29.2% |  3.789115 | 1.792050 | 47.3% |   199,109.0 | MPI_Allreduce(sync)
||========================================================================
|  25.9% |  3.366537 |       -- |    -- | 1,188,431.9 | MPI
||------------------------------------------------------------------------
||  18.0% |  2.334765 | 0.164646 |  6.6% |   199,109.0 | MPI_Allreduce
||   3.7% |  0.486714 | 0.882654 | 65.0% |   199,108.0 | MPI_Waitall
||   3.3% |  0.428731 | 0.557342 | 57.0% |   395,104.9 | MPI_Isend
|=========================================================================
</code></pre>
<h4 id="manual-program-analysis">Manual Program Analysis</h4>
<p>CrayPat allows you to manually choose your profiling preference. This is
particularly useful if the APA mode does not meet your tracing analysis
requirements.</p>
<p>The entire program can be traced as a whole using <code>-w</code>:</p>
<pre><code>auser@ln01:/work/t01/t01/auser&gt; pat_build -w jacobi
</code></pre>
<p>Using <code>-g</code>, a program can be instrumented to trace all function entry
point references belonging to the trace function group (mpi, libsci,
lapack, scalapack, heap, etc):</p>
<pre><code>auser@ln01:/work/t01/t01/auser&gt; pat_build -w -g mpi jacobi
</code></pre>
<h3 id="dynamically-linked-binaries">Dynamically-linked binaries</h3>
<p>CrayPat allows you to profile un-instrumented, dynamically linked
binaries with the <code>pat_run</code> utility. <code>pat_run</code> delivers profiling
information for codes that cannot easily be rebuilt. To use <code>pat_run</code>:</p>
<ol>
<li>
<p>Load the <code>perftools-base</code> module if it is not already loaded.</p>
<p><code>module load perftools-base</code></p>
</li>
<li>
<p>Run your application normally including the <code>pat_run</code> command right
    after your <code>srun</code> options.</p>
<p><code>srun [srun-options] pat_run [pat_run-options] program [program-options]</code></p>
</li>
<li>
<p>Use <code>pat_report</code> to examine any data collected during the execution
    of your application.</p>
<p><code>auser@ln01:/work/t01/t01/auser&gt; pat_report jacobi+pat+12265-1573s</code></p>
</li>
</ol>
<p>Some useful <code>pat_run</code> options are as follows.</p>
<ul>
<li><code>-w</code>  Collect data by tracing.</li>
<li><code>-g</code>  Trace functions belonging to group names. See the -g option in
    pat_build(1) for a list of valid tracegroup values.</li>
<li><code>-r</code>  Generate a text report upon successful execution.</li>
</ul>
<h3 id="further-help_1">Further help</h3>
<ul>
<li><a href="https://support.hpe.com/hpesc/public/docDisplay?docId=a00114942en_us&amp;page=index.html">CrayPat User Guide</a></li>
</ul>
<h2 id="cray-apprentice2">Cray Apprentice2</h2>
<p>Cray Apprentice2 is an optional GUI tool that is used to visualize and
manipulate the performance analysis data captured during program
execution. Cray Apprentice2 can display a wide variety of reports and graphs,
depending on the type of program being analyzed, the way in which the program
was instrumented for data capture, and the data that was collected during program
execution.</p>
<p>You will need to use CrayPat to first instrument your program and
capture performance analysis data, and then <code>pat_report</code> to generate
the <code>.ap2</code> files from the results. You may then use Cray Apprentice2 to
visualize and explore those files.</p>
<p>The number and appearance of the reports that can be generated using
Cray Apprentice2 is determined by the kind and quantity of data captured
during program execution, which in turn is determined by the way in
which the program was instrumented and the environment variables in
effect at the time of program execution. For example, changing the
PAT_RT_SUMMARY environment variable to 0 before executing the
instrumented program nearly doubles the number of reports available when
analyzing the resulting data in Cray Apprentice2.</p>
<pre><code>export PAT_RT_SUMMARY=0
</code></pre>
<p>To use Cray Apprentice2 (<code>app2</code>), load <code>perftools-base</code> module if it is
not already loaded.</p>
<pre><code>module load perftools-base
</code></pre>
<p>Next, open the experiment directory generated during the instrumentation
phase with Apprentice2.</p>
<pre><code>auser@ln01:/work/t01/t01/auser&gt; app2 jacobi+pat+12265-1573s
</code></pre>
<h2 id="hardware-performance-counters">Hardware Performance Counters</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Information on hardware counters will be added soon.</p>
</div>
<h2 id="performance-and-profiling-data-in-slurm">Performance and profiling data in Slurm</h2>
<p>Slurm commands on the login nodes can be used to quickly and simply retrieve
information about memory usage for currently running and completed jobs.</p>
<p>There are three commands you can use on ARCHER2 to query job data from 
Slurm, two are standard Slurm commands and one is a script that provides
information on running jobs:</p>
<ul>
<li>The <code>sstat</code> command is used to display status information of a running
  job or job step</li>
<li>The <code>sacct</code> command is used to display accounting data for all finished
  jobs and job steps within the Slurm job database.</li>
<li>The <code>archer2jobload</code> command is used to show CPU and memory usage information
  for running jobs. (This script is based on one originally written for the
  <a href="https://www.dur.ac.uk/icc/cosma/">COSMA HPC facility</a> at the University of
  Durham.)</li>
</ul>
<p>We provide examples of the use of these three commands below.</p>
<p>For the <code>sacct</code> and <code>sstat</code> command, the memory properties we print out below are:</p>
<ul>
<li><code>AveRSS</code> - The mean memory use per node over the length of the job</li>
<li><code>MaxRSS</code> - The maximum memory use per node measureed during the job</li>
<li><code>MaxRSSTask</code> - The maximum memory use from any process in the job</li>
</ul>
<h3 id="example-1-sstat-for-running-jobs">Example 1: <code>sstat</code> for running jobs</h3>
<p>To display the current memory use of a running job with the ID 123456:</p>
<div class="highlight"><pre><span></span><code>sstat --format=JobID,AveCPU,AveRSS,MaxRSS,MaxRSSTask -j 123456
</code></pre></div>
<h3 id="example-2-sacct-for-finished-jobs">Example 2: <code>sacct</code> for finished jobs</h3>
<p>To display the memory use of a completed job with the ID 123456:</p>
<div class="highlight"><pre><span></span><code>sacct --format=JobID,JobName,AveRSS,MaxRSS,MaxRSSTask -j 123456
</code></pre></div>
<p>Another usage of <code>sacct</code> is to display when a job was submitted, started running and ended for a particular user:</p>
<div class="highlight"><pre><span></span><code>sacct --format=JobID,Submit,Start,End -u auser
</code></pre></div>
<h3 id="example-3-archer2jobload-for-running-jobs">Example 3: <code>archer2jobload</code> for running jobs</h3>
<p>Using the <code>archer2jobload</code> command on its own with no options will show the current
CPU and memory use across compute nodes for all running jobs.</p>
<p>More usefully, you can provide a job ID to <code>archer2jobload</code> and it will show a summary
of the CPU and memory use for a specific job. For example, to get the usage data for job
123456, you would use:</p>
<div class="highlight"><pre><span></span><code>auser@ln01:~&gt; archer2jobload 123456
# JOB: 123456
CPU_LOAD            MEMORY              ALLOCMEM            FREE_MEM            TMP_DISK            NODELIST            
127.35-127.86       256000              239872              169686-208172       0                   nid[001481,001638-00
</code></pre></div>
<p>This shows the minimum CPU load on a compute node is 126.04 (close to the limit of 128 cores) with the maximum load 127.41 (indicating all the nodes are being used evenly). The minimum free memory is 171893 MB and the maximum free memory is 177224 MB.</p>
<p>If you add the <code>-l</code> option, you will see a breakdown per node:</p>
<div class="highlight"><pre><span></span><code>auser@ln01:~&gt; archer2jobload -l 276236
# JOB: 123456
NODELIST            CPU_LOAD            MEMORY              ALLOCMEM            FREE_MEM            TMP_DISK            
nid001481           127.86              256000              239872              169686              0                   
nid001638           127.60              256000              239872              171060              0                   
nid001639           127.64              256000              239872              171253              0                   
nid001677           127.85              256000              239872              173820              0                   
nid001678           127.75              256000              239872              173170              0                   
nid001891           127.63              256000              239872              173316              0                   
nid001921           127.65              256000              239872              207562              0                   
nid001922           127.35              256000              239872              208172              0 
</code></pre></div>
<h3 id="further-help-with-slurm">Further help with Slurm</h3>
<p>The definitions of any variables discussed here and more usage information can be found in the man pages of <code>sstat</code> and <code>sacct</code>.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../debug/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Debugging" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Debugging
            </div>
          </div>
        </a>
      
      
        
        <a href="../tuning/" class="md-footer__link md-footer__link--next" aria-label="Next: Performance tuning" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Performance tuning
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/ARCHER2-HPC" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/ARCHER2_HPC" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.linkedin.com/groups/13848871/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.5413a266.min.js"></script>
      
    
  </body>
</html>